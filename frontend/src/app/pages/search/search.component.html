<div class="max-w-7xl mx-auto px-4 py-6">
  <!-- Search Form Card -->
  <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
    <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">Events Search</h2>

    <form [formGroup]="searchForm" (ngSubmit)="onSubmit()">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Keyword Field with Autocomplete -->
        <div class="relative">
          <label class="block text-sm font-semibold mb-2 text-gray-700">
            Event <span class="text-red-500">*</span>
          </label>
          <div class="relative">
            <input
              type="text"
              formControlName="keyword"
              (input)="onKeywordInput($event)"
              (focus)="showSuggestions = suggestions.length > 0"
              (blur)="hideAutocomplete()"
              class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              [class.border-red-500]="
                searchForm.get('keyword')?.invalid && searchForm.get('keyword')?.touched
              "
              [class.border-gray-300]="
                !searchForm.get('keyword')?.invalid || !searchForm.get('keyword')?.touched
              "
              placeholder="Event"
            />

            <!-- Loading Spinner -->
            <div *ngIf="isLoadingSuggestions" class="absolute right-3 top-1/2 -translate-y-1/2">
              <svg
                class="animate-spin h-5 w-5 text-blue-500"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
              >
                <circle
                  class="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="4"
                ></circle>
                <path
                  class="opacity-75"
                  fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                ></path>
              </svg>
            </div>

            <!-- Clear Button -->
            <button
              *ngIf="searchForm.get('keyword')?.value && !isLoadingSuggestions"
              type="button"
              (click)="clearKeyword()"
              class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"
                />
              </svg>
            </button>

            <!-- Autocomplete Dropdown -->
            <div
              *ngIf="showSuggestions && suggestions.length > 0"
              class="absolute z-20 w-full mt-1 bg-white border-2 border-gray-300 rounded-lg shadow-xl max-h-60 overflow-auto"
            >
              <div
                *ngFor="let suggestion of suggestions"
                (click)="selectSuggestion(suggestion)"
                class="px-4 py-3 hover:bg-blue-50 cursor-pointer border-b last:border-b-0 transition-colors"
              >
                {{ suggestion.name }}
              </div>
            </div>
          </div>
          <div
            *ngIf="searchForm.get('keyword')?.invalid && searchForm.get('keyword')?.touched"
            class="text-red-500 text-sm mt-1"
          >
            Please enter a keyword
          </div>
        </div>

        <!-- Distance Field -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700">
            Distance <span class="text-red-500">*</span>
          </label>
          <div class="relative">
            <input
              type="number"
              formControlName="distance"
              class="w-full px-4 py-3 pr-16 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              [class.border-red-500]="
                searchForm.get('distance')?.invalid && searchForm.get('distance')?.touched
              "
              [class.border-gray-300]="
                !searchForm.get('distance')?.invalid || !searchForm.get('distance')?.touched
              "
              min="1"
            />
            <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium"
              >miles</span
            >
          </div>
        </div>

        <!-- Category Dropdown -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700">
            Category <span class="text-red-500">*</span>
          </label>
          <select
            formControlName="category"
            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white"
          >
            <option *ngFor="let cat of categories" [value]="cat.value">{{ cat.label }}</option>
          </select>
        </div>

        <!-- Location Field -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-700">
            Location
            <span class="text-red-500" *ngIf="!searchForm.get('autoDetect')?.value">*</span>
          </label>
          <div class="relative">
            <input
              type="text"
              formControlName="location"
              class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              [class.bg-gray-100]="searchForm.get('autoDetect')?.value"
              [class.cursor-not-allowed]="searchForm.get('autoDetect')?.value"
              [class.border-red-500]="
                searchForm.get('location')?.invalid &&
                searchForm.get('location')?.touched &&
                !searchForm.get('autoDetect')?.value
              "
              [class.border-gray-300]="
                !searchForm.get('location')?.invalid ||
                !searchForm.get('location')?.touched ||
                searchForm.get('autoDetect')?.value
              "
              [placeholder]="
                searchForm.get('autoDetect')?.value
                  ? detectedLocationName ||
                    (isDetectingLocation ? 'Detecting location...' : 'Using detected location')
                  : 'Enter city, state, or address'
              "
              [readonly]="searchForm.get('autoDetect')?.value"
            />

            <!-- Location detected indicator (friendly name shown below input) -->
            <div
              *ngIf="searchForm.get('autoDetect')?.value && detectedLocationName"
              class="text-sm text-gray-600 mt-1 ml-1"
            >
              Using detected location: {{ detectedLocationName }}
            </div>
          </div>
          <div
            *ngIf="
              searchForm.get('location')?.invalid &&
              searchForm.get('location')?.touched &&
              !searchForm.get('autoDetect')?.value
            "
            class="text-red-500 text-sm mt-1"
          >
            Please enter a location
          </div>
        </div>
      </div>

      <!-- Auto-detect Location Checkbox -->
      <div class="mt-6">
        <label class="flex items-center space-x-3 cursor-pointer">
          <input
            type="checkbox"
            formControlName="autoDetect"
            class="w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
          />
          <span class="text-sm font-medium text-gray-700">Auto-detect your location</span>
        </label>
        <p class="text-xs text-gray-500 mt-1 ml-8">
          <ng-container *ngIf="!searchForm.get('autoDetect')?.value">
            Uncheck to enter location manually (e.g., "Los Angeles", "California", "90001")
          </ng-container>
          <ng-container *ngIf="searchForm.get('autoDetect')?.value">
            Using your current location based on IP address
          </ng-container>
        </p>
      </div>

      <!-- Action Buttons -->
      <div class="flex gap-4 mt-8 justify-center">
        <button
          type="submit"
          [disabled]="isSearching || isDetectingLocation"
          class="px-8 py-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 shadow-md transition-all"
        >
          <svg
            *ngIf="isSearching"
            class="animate-spin h-5 w-5"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle
              class="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="4"
            ></circle>
            <path
              class="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
            ></path>
          </svg>
          <span>{{ isSearching ? 'Searching...' : 'Submit' }}</span>
        </button>

        <button
          type="button"
          (click)="clearForm()"
          class="px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 shadow-md transition-all"
        >
          Clear
        </button>
      </div>
    </form>
  </div>

  <!-- No Results Message -->
  <div *ngIf="noResults" class="text-center py-16">
    <svg
      class="mx-auto h-24 w-24 text-gray-400 mb-4"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
      />
    </svg>
    <p class="text-2xl text-gray-500 font-medium">No results available</p>
  </div>

  <!-- Results Header -->
  <div *ngIf="events.length > 0" class="mb-6">
    <h3 class="text-2xl font-bold text-gray-800">Results</h3>
    <p class="text-gray-600 mt-1">
      Found {{ events.length }} event{{ events.length !== 1 ? 's' : '' }}
    </p>
  </div>

  <!-- Events Grid -->
  <div
    *ngIf="events.length > 0"
    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
  >
    <div
      *ngFor="let event of events"
      (click)="viewEventDetail(event.id)"
      class="bg-white rounded-lg shadow-md overflow-hidden cursor-pointer hover:shadow-xl transition-all transform hover:-translate-y-1"
    >
      <!-- Event Image -->
      <div class="relative h-48 bg-gray-200 overflow-hidden">
        <img
          [src]="event.image"
          [alt]="event.name"
          class="w-full h-full object-cover"
          onerror="this.src='https://via.placeholder.com/300x200?text=No+Image'"
        />

        <!-- Category Badge -->
        <div class="absolute top-2 left-2">
          <span
            class="px-3 py-1 bg-blue-600 text-white text-xs font-semibold rounded-full shadow-md"
          >
            {{ event.category }}
          </span>
        </div>

        <!-- Favorite Button -->
        <button
          (click)="toggleFavorite(event, $event)"
          class="absolute top-2 right-2 p-2 bg-white rounded-full shadow-lg hover:bg-gray-100 transition-colors z-10"
        >
          <svg
            class="w-6 h-6 transition-all"
            [class.fill-red-500]="isFavorite(event.id)"
            [class.text-red-500]="isFavorite(event.id)"
            [class.fill-none]="!isFavorite(event.id)"
            [class.text-gray-700]="!isFavorite(event.id)"
            stroke="currentColor"
            stroke-width="2"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
            />
          </svg>
        </button>
      </div>

      <!-- Event Details -->
      <div class="p-4">
        <h3 class="font-bold text-lg mb-3 line-clamp-2 text-gray-800 min-h-[3.5rem]">
          {{ event.name }}
        </h3>

        <div class="space-y-2 text-sm text-gray-600">
          <div class="flex items-start">
            <svg
              class="w-4 h-4 mr-2 mt-0.5 flex-shrink-0 text-gray-500"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
              />
            </svg>
            <span>{{ formatDate(event.date, event.time) }}</span>
          </div>

          <div class="flex items-start">
            <svg
              class="w-4 h-4 mr-2 mt-0.5 flex-shrink-0 text-gray-500"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
              />
            </svg>
            <span class="line-clamp-2">{{ event.venue }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
